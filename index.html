<!DOCTYPE html>
<html>
<head>
  <title>Ms. Balaji Jules Orders</title>
  <style>
    body{font-family:Arial;background:#f4f4f4;text-align:center;margin:0;padding:0}
    h1{background:#333;color:white;padding:20px;margin:0}
    .box{width:90%;max-width:600px;background:white;margin:30px auto;padding:20px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1)}
    input,button,select{width:100%;padding:10px;margin:5px 0;border-radius:6px;border:1px solid #aaa}
    button{background:#333;color:white;border:none;cursor:pointer}
    button:hover{background:#555}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #aaa;padding:8px;text-align:left}
    .deleteBtn{background:red;color:white;padding:4px 8px;border-radius:4px;font-size:12px;cursor:pointer}
    .deleteBtn:hover{background:darkred}
    .hidden{display:none}
  </style>
</head>
<body>

<h1>Welcome to Ms. Balaji Jules Orders</h1>

<!-- START -->
<div id="startPage" class="box">
  <button onclick="employeeFlow()">I am Employee</button>
  <button onclick="notEmployeeFlow()">I am Not Employee</button>
  <button onclick="managerFlow()">I am Manager</button>
</div>

<!-- EMPLOYEE LOGIN -->
<div id="codePage" class="box hidden">
  <h2>Enter Employee Code</h2>
  <input id="employeeCode" type="password">
  <button onclick="checkEmployeeCode()">Submit</button>
  <button onclick="backToStart()">Back</button>
</div>

<!-- EMPLOYEE PAGE -->
<div id="employeePage" class="box hidden">
  <h2>Add Items</h2>
  <input id="itemName" placeholder="Item Name">
  <input id="itemPrice" type="number" placeholder="Price">
  <button onclick="addItem()">Add Item</button>

  <h3>Items</h3>
  <table id="listingTable"><tbody></tbody></table>

  <h3>Orders</h3>
  <table id="employeeOrdersTable"><tbody></tbody></table>

  <button onclick="backToStart()">Back</button>
</div>

<!-- CUSTOMER ORDER PAGE -->
<div id="orderPage" class="box hidden">
  <h2>Place Order</h2>
  <input id="orderName" placeholder="Your Name">
  <input id="orderQty" type="number" placeholder="Qty">
  <select id="orderItem"></select>
  <button onclick="submitOrder()">Submit Order</button>
  <button onclick="applyForEmployee()">Apply for Employee</button>
  <p id="orderMessage"></p>
  <p id="applyMessage"></p>

  <h3>Orders</h3>
  <table id="orderTable"><tbody></tbody></table>

  <button onclick="backToStart()">Back</button>
</div>

<!-- MANAGER LOGIN -->
<div id="managerLoginPage" class="box hidden">
  <h2>Manager Password</h2>
  <input id="managerPassword" type="password">
  <button onclick="checkManagerPassword()">Submit</button>
  <button onclick="backToStart()">Back</button>
</div>

<!-- MANAGER PAGE -->
<div id="managerPage" class="box hidden">
  <h2>Employee Requests</h2>
  <table id="managerTable"><tbody></tbody></table>
  <button onclick="backToStart()">Back</button>
</div>

<script>
let isEmployee=false;

function showPage(p){
  ["startPage","codePage","employeePage","orderPage","managerLoginPage","managerPage"].forEach(id=>{
    document.getElementById(id).style.display="none";
  });
  document.getElementById(p).style.display="block";
  localStorage.setItem("currentPage",p);
}

function employeeFlow(){isEmployee=true;showPage("codePage")}
function notEmployeeFlow(){isEmployee=false;showPage("orderPage");updateOrderTable();populateOrderSelect()}
function managerFlow(){showPage("managerLoginPage")}
function backToStart(){showPage("startPage")}

function checkEmployeeCode(){
  const code=document.getElementById("employeeCode").value;
  const codes=JSON.parse(localStorage.getItem("employeeCodes")||"{}");

  let emp=Object.keys(codes).find(n=>codes[n]===code);
  if(!emp){alert("Wrong code.");return;}

  showPage("employeePage");
  updateListingTable();updateEmployeeOrdersTable();populateOrderSelect();
}

function checkManagerPassword(){
  if(document.getElementById("managerPassword").value==="manageristhebest1234"){
    showPage("managerPage");updateManagerTable();
  } else alert("Wrong password");
}

function addItem(){
  let n=itemName.value.trim(), p=parseFloat(itemPrice.value);
  if(!n||isNaN(p)){alert("Fill both");return;}
  let items=JSON.parse(localStorage.getItem("items")||"[]");
  items.push({name:n,price:p});
  localStorage.setItem("items",JSON.stringify(items));
  itemName.value="";itemPrice.value="";
  updateListingTable();populateOrderSelect();
}

function deleteItem(i){
  let items=JSON.parse(localStorage.getItem("items")||"[]");
  items.splice(i,1);
  localStorage.setItem("items",JSON.stringify(items));
  updateListingTable();populateOrderSelect();
}

function updateListingTable(){
  let items=JSON.parse(localStorage.getItem("items")||"[]");
  let tb=document.querySelector("#listingTable tbody");
  tb.innerHTML="";
  items.forEach((x,i)=>{
    tb.innerHTML+=`<tr><td>${x.name}</td><td>$${x.price}</td>
      <td><button class='deleteBtn' onclick='deleteItem(${i})'>X</button></td></tr>`;
  });
}

function populateOrderSelect(){
  let items=JSON.parse(localStorage.getItem("items")||"[]");
  let s=document.getElementById("orderItem");
  if(!s)return;
  s.innerHTML="";
  items.forEach((x,i)=>{
    s.innerHTML+=`<option value='${i}'>${x.name} ($${x.price})</option>`;
  });
}

function updateEmployeeOrdersTable(){
  let orders=JSON.parse(localStorage.getItem("orders")||"[]");
  let tb=document.querySelector("#employeeOrdersTable tbody");
  tb.innerHTML="";
  orders.forEach((o,i)=>{
    tb.innerHTML+=`<tr><td>${o.customer}</td><td>${o.item}</td><td>${o.quantity}</td>
      <td><button class='deleteBtn' onclick='deleteOrder(${i})'>X</button></td></tr>`;
  });
}

function updateOrderTable(){
  let orders=JSON.parse(localStorage.getItem("orders")||"[]");
  let tb=document.querySelector("#orderTable tbody");
  tb.innerHTML="";
  orders.forEach(o=>{
    tb.innerHTML+=`<tr><td>${o.customer}</td><td>${o.item}</td><td>${o.quantity}</td></tr>`;
  });
}

function submitOrder(){
  let name=orderName.value.trim(), qty=parseInt(orderQty.value), idx=orderItem.value;
  let items=JSON.parse(localStorage.getItem("items")||"[]");
  if(!name||!qty||idx===""){alert("Fill all");return;}
  let orders=JSON.parse(localStorage.getItem("orders")||"[]");
  orders.push({customer:name,item:items[idx].name,quantity:qty});
  localStorage.setItem("orders",JSON.stringify(orders));
  orderName.value="";orderQty.value="";
  updateOrderTable();updateEmployeeOrdersTable();
  orderMessage.textContent="Order saved.";
}

function deleteOrder(i){
  let orders=JSON.parse(localStorage.getItem("orders")||"[]");
  orders.splice(i,1);
  localStorage.setItem("orders",JSON.stringify(orders));
  updateOrderTable();updateEmployeeOrdersTable();
}

function applyForEmployee(){
  let n=orderName.value.trim();
  if(!n){alert("Enter name");return;}
  let req=JSON.parse(localStorage.getItem("jobRequests")||"{}");

  if(req[n]==="pending"||req[n]==="approved"){
    applyMessage.textContent="Already applied.";
    return;
  }

  req[n]="pending";
  localStorage.setItem("jobRequests",JSON.stringify(req));
  applyMessage.textContent="Application sent!";
}

function updateManagerTable(){
  let req=JSON.parse(localStorage.getItem("jobRequests")||"{}");
  let tb=document.querySelector("#managerTable tbody");
  tb.innerHTML="";
  for(let n in req){
    let a="";
    if(req[n]==="pending") a=`<button onclick="approveEmployee('${n}')">Approve</button>`;
    if(req[n]==="approved") a=`<button onclick="fireEmployee('${n}')">Fire</button>`;
    tb.innerHTML+=`<tr><td>${n}</td><td>${req[n]}</td><td>${a}</td></tr>`;
  }
}

function approveEmployee(n){
  let req=JSON.parse(localStorage.getItem("jobRequests")||"{}");
  req[n]="approved";
  localStorage.setItem("jobRequests",JSON.stringify(req));

  let codes=JSON.parse(localStorage.getItem("employeeCodes")||"{}");
  codes[n]=(Math.floor(10000000+Math.random()*90000000)).toString();
  localStorage.setItem("employeeCodes",JSON.stringify(codes));

  alert(n+" approved.");
  updateManagerTable();
}

function fireEmployee(n){
  if(!confirm("Fire "+n+"?"))return;

  let req=JSON.parse(localStorage.getItem("jobRequests")||"{}");
  let codes=JSON.parse(localStorage.getItem("employeeCodes")||"{}");

  delete req[n];  
  delete codes[n];

  localStorage.setItem("jobRequests",JSON.stringify(req));
  localStorage.setItem("employeeCodes",JSON.stringify(codes));

  alert(n+" fired.");
  updateManagerTable();
}

window.onload=function(){
  let p=localStorage.getItem("currentPage")||"startPage";
  showPage(p);
  if(p==="employeePage"){updateListingTable();updateEmployeeOrdersTable();populateOrderSelect()}
  if(p==="orderPage"){updateOrderTable();populateOrderSelect()}
  if(p==="managerPage")updateManagerTable();
}
</script>

</body>
</html>
